<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>login test</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="public/css/style.css" rel="stylesheet" type="text/css" />

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body class="text-center">

    <div id="header">
         <div id="loggedIn"></div>
        <button id="logout">LOGOUT</button>
    </div>
       

    <div id="main"></div>

    <!-- Trigger/Open The Modal -->
    <button id="myBtn">Add TimeSlot</button>

    <!-- The Modal -->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Co</p>
            <label>Date: (YYYY-MM-DD)</label><input type="text" id="date">
            <label>Start Time: (HH:MM:SS)</label><input type="text" id="startTime">
            <label>End Time: (HH:MM:SS)</label><input type="text" id="endTime">
            <button id="confirmTimeSlot">Confirm Time Slot</button>
        </div>

    </div>



 <!-- The Modal -->
    <div id="myModal2" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            {{!--<span class="close2">&times;</span>--}}
            <p>Are you sure you want to delete this time slot?</p>
            <label>Start Time: (HH:MM:SS)</label><span id="confirmST"></span>
            <label>End Time: (HH:MM:SS)</label><span id="confirmET"></span>
            
            <button class="close2">Cancel</button>
            <button id="confirmDelete">Confirm Delete</button>
        </div>

    </div>


    <script>
        $(document).ready(function() {

            $('#loggedIn').html("Logged in as: " + "{{loggedIn}}");

            //populate a list of timeSlots
            $.ajax({
                type: "POST",
                url: "/test/getTimeSlots",
                dataType: "json",
                contentType: "application/json",

                success: function(result, status) {
                    console.log(result);
                    console.log(result.success);
                    if (result.response) {
                        console.log(result);
                    }
                    else {
                        console.log(result.message);
                    }

                    console.log("result is this: ", result);

                    for (let i = 0; i < result.retrievedTimeSlots.length; i++) {
                        $("#main").append(`
                                    <div id="slot${i}" class='d-flex mb-3 justify-content-between'>
                                        <span class="flex-container" >
                                            <div>
                                            <span class="font-weight-bold">Date: </span><span>${result.retrievedTimeSlots[i].date.substring(0, 10)}</span>
                                            </div>
                                            <div>
                                            <span class="font-weight-bold">Start Time: </span><span>${result.retrievedTimeSlots[i].startTime}</span>
                                            </div>
                                            <div>
                                            <span class="font-weight-bold">End Time: </span><span>${result.retrievedTimeSlots[i].endTime}</span>
                                            </div>
                                        </span>
                                        <span>
                                            <button type='button' id="${"dbutton" + i}" class="btn btn-info" value="${result.retrievedTimeSlots[i].timeSlotId}" >Delete Time Slot</button>
                                        </span>
                                    </div>
                                    <hr>`);
                        // $(`#dbutton${i}`).click(function() { deleteTimeSlot(`${result.retrievedTimeSlots[i].timeSlotId}`) });
                        $(`#dbutton${i}`).click(function() { openModal2(`${result.retrievedTimeSlots[i].timeSlotId}`) });
                    }
                }
            }); //AJAX


            var tempId;

            function openModal2(toDelete){
                 modal2.style.display = "block";
                //  $('#confirmDelete').on("click", deleteTimeSlot(toDelete));
                tempId = toDelete;
                 
            }

             $('#confirmDelete').on("click", function() {
                 deleteTimeSlot(tempId);
             });

            
            function deleteTimeSlot(id) {

                $.ajax({
                    url: "/test/deleteTimeSlot",
                    method: "POST",
                    data: {
                        timeSlotId: id
                    },
                    success: function(result, status) {
                        console.log(result);

                        if (result.successful) {}
                        else {
                            $("#errorMessage").html(result.message).css("color", 'red');
                        }
                    }
                }); //ajax
                location.reload();
            }


            // Get the modal
            var modal = document.getElementById("myModal");

            // Get the button that opens the modal
            var btn = document.getElementById("myBtn");

            // Get the <span> element that closes the modal
            var span = document.getElementsByClassName("close")[0];

            // When the user clicks on the button, open the modal
            btn.onclick = function() {
                modal.style.display = "block";
            }

            // When the user clicks on <span> (x), close the modal
            span.onclick = function() {
                modal.style.display = "none";
            }

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }








         // Get the modal2
            var modal2 = document.getElementById("myModal2");

            // Get the <span> element that closes the modal
            var span2 = document.getElementsByClassName("close2")[0];

            // When the user clicks on <span> (x), close the modal
            span2.onclick = function() {
                modal2.style.display = "none";
            }

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal2.style.display = "none";
                }
            }








             $('#confirmTimeSlot').on("click", addTimeSlot);
             function addTimeSlot() {
                  $.ajax({
                            url: "/test/addTimeSlot",
                            method: "POST",
                            data: {
                                date: $('#date').val(),
                                startTime: String($('#startTime').val()),
                                endTime: String($('#endTime').val())
                            },
                            success: function(result, status) {
                                console.log(result);

                                if (result.successful) {
                                }
                                else {
                                    $("#errorMessage").html(result.message).css("color", 'red');
                                }
                            }
                        }); //ajax
                        location.reload();
                    }
             


            //logout listener
            $("#logout").on("click", logout);

            function logout() {
                $.ajax({
                    url: "/test/logout",
                    method: "GET",
                    success: function(result, status) {
                        console.log(result);

                        if (result.successful) {
                            window.location.href = "/test/";
                        }
                        else {
                            $("#errorMessage").html(result.message).css("color", red);
                        }
                    }
                }); //ajax
            }



        }); //doc ready
    </script>


</body>

</html>
